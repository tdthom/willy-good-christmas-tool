<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Willy Good – Christmas Lights Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    header {
      background: #004b80;
      color: white;
      padding: 10px 16px;
    }
    nav {
      background: #eee;
      padding: 8px 16px;
      display: flex;
      gap: 8px;
    }
    nav button {
      padding: 6px 12px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
    }
    nav button.active {
      border-color: #004b80;
      font-weight: bold;
    }
    .screen {
      display: none;
      padding: 16px;
    }
    .screen.active {
      display: block;
    }
      .proposal-card {
      border: 1px solid #ccc;
      padding: 16px;
      margin-top: 16px;
      max-width: 650px;
      background: #fff;
    }
    .proposal-card-inner h3 {
      margin-top: 0.5rem;
    }
    .proposal-totals p {
      margin: 0.2rem 0;
    }

  </style>
</head>
<body>
  <header>
    <h1>Willy Good Christmas Lights Tool</h1>
    <p>One app, four screens: Clients • Estimate • Photo Mockup • Proposal</p>
  </header>

  <nav>
    <button data-screen="clients" class="active">Clients</button>
    <button data-screen="estimate">Estimate</button>
    <button data-screen="mockup">Photo Mockup</button>
    <button data-screen="proposal">Proposal</button>
  </nav>

    <!-- Screen 1: Clients -->
  <section id="screen-clients" class="screen active">
    <h2>Clients</h2>
    <p>Save basic client details and their preferred install date/week.</p>

    <h3>Add / update client</h3>

    <label for="client-name"><strong>Client name</strong></label><br />
    <input id="client-name" type="text" placeholder="e.g. John Smith" />
    <br /><br />

    <label for="client-phone"><strong>Phone</strong></label><br />
    <input id="client-phone" type="tel" placeholder="e.g. 555-123-4567" />
    <br /><br />

    <label for="client-email"><strong>Email</strong></label><br />
    <input id="client-email" type="email" placeholder="e.g. john@example.com" />
    <br /><br />

    <label for="client-address"><strong>Service address</strong></label><br />
    <textarea id="client-address" rows="3" placeholder="Street, city, ZIP"></textarea>
    <br /><br />

    <label for="client-preferred"><strong>Preferred install date/week</strong></label><br />
    <input id="client-preferred" type="text" placeholder="e.g. Week of Nov 25 or 2025-11-28" />
    <br /><br />

    <label for="client-notes"><strong>Notes</strong></label><br />
    <textarea id="client-notes" rows="3" placeholder="Gate code, roof access, special requests…"></textarea>
    <br /><br />

    <button id="save-client">Save client</button>

    <h3>Saved clients</h3>
    <ul id="clients-list">
      <!-- Filled in by script -->
    </ul>
  </section>

  <!-- Screen 2: Estimate -->
  <section id="screen-estimate" class="screen">
    <h2>Estimate</h2>
    <p>Enter your measurements below to get a quick price.</p>

    <div id="current-client-summary" style="margin-bottom: 1rem; font-size: 0.9rem;">
      <em>No client selected. Go to the Clients tab and click "Use for estimate".</em>
    </div>

  
    <h3>Feet of Lights</h3>

    <label for="ridge-feet"><strong>Main ridge</strong> (ft)</label><br />
    <input id="ridge-feet" type="number" min="0" step="1" placeholder="e.g. 80" /> ft
    <br /><br />

    <label for="hip-feet"><strong>Hip ridge</strong> (ft)</label><br />
    <input id="hip-feet" type="number" min="0" step="1" placeholder="e.g. 50" /> ft
    <br /><br />

    <label for="eaves-feet"><strong>Eaves / gutters</strong> (ft)</label><br />
    <input id="eaves-feet" type="number" min="0" step="1" placeholder="e.g. 20" /> ft
    <br /><br />

    <h3>Pricing</h3>

    <label for="rate-per-foot"><strong>Install price per foot</strong> you want to charge</label><br />
    <input id="rate-per-foot" type="number" min="0" step="0.01" value="4.00" /> $/ft
    <br /><br />

    <label for="takedown-rate"><strong>Takedown price per foot</strong></label><br />
    <input id="takedown-rate" type="number" min="0" step="0.01" value="2.00" /> $/ft
    <br /><br />

    <label for="tax-rate"><strong>Sales tax rate</strong> (%)</label><br />
    <input id="tax-rate" type="number" min="0" step="0.01" value="8.25" /> %
    <br /><br />

    <label for="container-cost"><strong>Container cost (internal only)</strong></label><br />
    <input id="container-cost" type="number" min="0" step="0.01" value="0.00" /> $
    <br /><br />

    <button id="calc-estimate">Calculate Estimate</button>

    <h3>Result</h3>
    <div id="estimate-result">
      Enter values and click "Calculate Estimate" to see the price.
    </div>
  </section>




  <!-- Screen 3: Photo Mockup -->
  <section id="screen-mockup" class="screen">
    <h2>Photo Mockup</h2>
    <p>This is where you’ll upload a photo and mark where lights go.</p>
  </section>

    <!-- Screen 4: Proposal -->
  <section id="screen-proposal" class="screen">
    <h2>Proposal</h2>
    <p>Preview what you can send to the client. Use your browser’s Print → “Save as PDF” to export.</p>

    <button id="refresh-proposal" style="margin-bottom: 0.5rem;">Refresh proposal</button>

    <div id="proposal-content" class="proposal-card">
      <em>No estimate found yet. Go to the Estimate tab, fill it out, and click "Calculate Estimate" first.</em>
    </div>
  </section>


    <script>
    // -----------------------------
    // Navigation: switch between screens
    // -----------------------------
    const buttons = document.querySelectorAll("nav button");
    const screens = document.querySelectorAll(".screen");

    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.screen;

        buttons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        screens.forEach((s) => {
          if (s.id === "screen-" + target) {
            s.classList.add("active");
          } else {
            s.classList.remove("active");
          }
        });
      });
    });

    // -----------------------------
    // Clients & estimate storage (localStorage)
    // -----------------------------
    const CLIENTS_KEY = "wgc-clients-v1";
    const CURRENT_CLIENT_KEY = "wgc-current-client-id";
    const ESTIMATE_KEY = "wgc-last-estimate-v1";

    function loadClients() {
      try {
        const raw = localStorage.getItem(CLIENTS_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        console.warn("Could not load clients", e);
        return [];
      }
    }

    function saveClients(clients) {
      try {
        localStorage.setItem(CLIENTS_KEY, JSON.stringify(clients));
      } catch (e) {
        console.warn("Could not save clients", e);
      }
    }

    function loadCurrentClientId() {
      try {
        const raw = localStorage.getItem(CURRENT_CLIENT_KEY);
        if (!raw) return null;
        const id = parseInt(raw, 10);
        return Number.isNaN(id) ? null : id;
      } catch {
        return null;
      }
    }

    function saveCurrentClientId(id) {
      try {
        if (id == null) {
          localStorage.removeItem(CURRENT_CLIENT_KEY);
        } else {
          localStorage.setItem(CURRENT_CLIENT_KEY, String(id));
        }
      } catch (e) {
        console.warn("Could not save current client id", e);
      }
    }

    function loadLastEstimate() {
      try {
        const raw = localStorage.getItem(ESTIMATE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      } catch (e) {
        console.warn("Could not load last estimate", e);
        return null;
      }
    }

    function saveLastEstimate(data) {
      try {
        localStorage.setItem(ESTIMATE_KEY, JSON.stringify(data));
      } catch (e) {
        console.warn("Could not save last estimate", e);
      }
    }

    // -----------------------------
    // Clients UI
    // -----------------------------
    const clientNameInput = document.getElementById("client-name");
    const clientPhoneInput = document.getElementById("client-phone");
    const clientEmailInput = document.getElementById("client-email");
    const clientAddressInput = document.getElementById("client-address");
    const clientPreferredInput = document.getElementById("client-preferred");
    const clientNotesInput = document.getElementById("client-notes");
    const saveClientButton = document.getElementById("save-client");
    const clientsList = document.getElementById("clients-list");
    const currentClientSummaryDiv = document.getElementById("current-client-summary");

    let clients = loadClients();
    let currentClientId = loadCurrentClientId();

    function getCurrentClient() {
      if (currentClientId == null) return null;
      return clients.find((c) => c.id === currentClientId) || null;
    }

    function updateCurrentClientSummary() {
      if (!currentClientSummaryDiv) return;
      const c = getCurrentClient();
      if (!c) {
        currentClientSummaryDiv.innerHTML =
          '<em>No client selected. Go to the Clients tab and click "Use for estimate".</em>';
      } else {
        currentClientSummaryDiv.innerHTML = `
          <strong>Current client:</strong> ${c.name}<br />
          ${c.address ? c.address + "<br />" : ""}
          ${c.phone ? "Phone: " + c.phone + "<br />" : ""}
          ${c.preferred ? "Preferred install: " + c.preferred : ""}
        `;
      }
    }

    function renderClientsList() {
      if (!clientsList) return;

      if (!clients.length) {
        clientsList.innerHTML = "<li>No clients saved yet.</li>";
        return;
      }

      clientsList.innerHTML = clients
        .map((c) => {
          const safeName = c.name || "(No name)";
          const safeAddress = c.address || "";
          const safePhone = c.phone || "-";
          const safeEmail = c.email || "-";
          const safePreferred = c.preferred || "-";
          const isCurrent = c.id === currentClientId;

          return `
            <li data-client-id="${c.id}">
              <strong>${safeName}</strong>${isCurrent ? " (current)" : ""}<br />
              ${safeAddress ? safeAddress + "<br />" : ""}
              Phone: ${safePhone} | Email: ${safeEmail}<br />
              Preferred install: ${safePreferred}<br />
              <button class="use-client-button" data-client-id="${c.id}">
                Use for estimate
              </button>
            </li>
          `;
        })
        .join("");
    }

    if (saveClientButton) {
      saveClientButton.addEventListener("click", () => {
        const name = (clientNameInput.value || "").trim();
        const phone = (clientPhoneInput.value || "").trim();
        const email = (clientEmailInput.value || "").trim();
        const address = (clientAddressInput.value || "").trim();
        const preferred = (clientPreferredInput.value || "").trim();
        const notes = (clientNotesInput.value || "").trim();

        if (!name) {
          alert("Please enter at least a client name.");
          return;
        }

        const newClient = {
          id: Date.now(),
          name,
          phone,
          email,
          address,
          preferred,
          notes,
        };

        clients.push(newClient);
        saveClients(clients);

        // Make the new client the current client
        currentClientId = newClient.id;
        saveCurrentClientId(currentClientId);

        renderClientsList();
        updateCurrentClientSummary();

        // Clear form
        clientNameInput.value = "";
        clientPhoneInput.value = "";
        clientEmailInput.value = "";
        clientAddressInput.value = "";
        clientPreferredInput.value = "";
        clientNotesInput.value = "";
      });
    }

    if (clientsList) {
      clientsList.addEventListener("click", (event) => {
        const btn = event.target.closest(".use-client-button");
        if (!btn) return;

        const id = parseInt(btn.dataset.clientId, 10);
        if (Number.isNaN(id)) return;

        currentClientId = id;
        saveCurrentClientId(currentClientId);
        renderClientsList();
        updateCurrentClientSummary();
      });
    }

    // Initial client render
    renderClientsList();
    updateCurrentClientSummary();

    // -----------------------------
    // Estimator logic: ridge + hip + eaves + takedown + tax
    // -----------------------------
    const ridgeInput = document.getElementById("ridge-feet");
    const hipInput = document.getElementById("hip-feet");
    const eavesInput = document.getElementById("eaves-feet");
    const rateInput = document.getElementById("rate-per-foot");
    const takedownRateInput = document.getElementById("takedown-rate");
    const taxRateInput = document.getElementById("tax-rate");
    const containerInput = document.getElementById("container-cost");
    const calcButton = document.getElementById("calc-estimate");
    const resultBox = document.getElementById("estimate-result");

    if (calcButton) {
      calcButton.addEventListener("click", () => {
        const ridge = parseFloat(ridgeInput.value) || 0;
        const hip = parseFloat(hipInput.value) || 0;
        const eaves = parseFloat(eavesInput.value) || 0;
        const rate = parseFloat(rateInput.value) || 0;
        const takedownRate = parseFloat(takedownRateInput.value) || 0;
        const taxRatePercent = parseFloat(taxRateInput.value) || 0;
        const container = parseFloat(containerInput.value) || 0;

        const totalFeet = ridge + hip + eaves;

        // Install prices
        const ridgePrice = ridge * rate;
        const hipPrice = hip * rate;
        const eavesPrice = eaves * rate;
        const installSubtotal = ridgePrice + hipPrice + eavesPrice;

        // Takedown
        const takedownSubtotal = totalFeet * takedownRate;

        // Customer subtotal before tax
        const customerSubtotal = installSubtotal + takedownSubtotal;

        // Tax
        const taxRate = taxRatePercent / 100;
        const taxAmount = customerSubtotal * taxRate;
        const customerTotalWithTax = customerSubtotal + taxAmount;

        // Internal total (pre-tax) including container
        const internalTotal = customerSubtotal + container;

        // Save last estimate snapshot (for proposal)
        const currentClient = getCurrentClient();
        const estimateSnapshot = {
          timestamp: new Date().toISOString(),
          totalFeet,
          ridge,
          hip,
          eaves,
          rate,
          takedownRate,
          taxRatePercent,
          installSubtotal,
          takedownSubtotal,
          customerSubtotal,
          taxAmount,
          customerTotalWithTax,
          client: currentClient
            ? {
                name: currentClient.name,
                address: currentClient.address,
                phone: currentClient.phone,
                email: currentClient.email,
                preferred: currentClient.preferred,
              }
            : null,
        };
        saveLastEstimate(estimateSnapshot);

        resultBox.innerHTML = `
          <p><strong>Total feet:</strong> ${totalFeet.toFixed(0)} ft</p>
          <p><strong>Main ridge:</strong> ${ridge.toFixed(0)} ft → $${ridgePrice.toFixed(2)}</p>
          <p><strong>Hip ridge:</strong> ${hip.toFixed(0)} ft → $${hipPrice.toFixed(2)}</p>
          <p><strong>Eaves / gutters:</strong> ${eaves.toFixed(0)} ft → $${eavesPrice.toFixed(2)}</p>
          <hr />
          <p><strong>Install subtotal:</strong> $${installSubtotal.toFixed(2)}</p>
          <p><strong>Takedown subtotal:</strong> $${takedownSubtotal.toFixed(2)}</p>
          <p><strong>Customer subtotal (install + takedown, before tax):</strong> $${customerSubtotal.toFixed(2)}</p>
          <p><strong>Sales tax (${taxRatePercent.toFixed(2)}%):</strong> $${taxAmount.toFixed(2)}</p>
          <p><strong>Customer total (with tax):</strong> $${customerTotalWithTax.toFixed(2)}</p>
          <br />
          <p><strong>Internal container cost (not shown on proposal):</strong> $${container.toFixed(2)}</p>
          <p><strong>Internal total (install + takedown + container, pre-tax):</strong> $${internalTotal.toFixed(2)}</p>
        `;
      });
    }

    // -----------------------------
    // Proposal rendering
    // -----------------------------
    const proposalContent = document.getElementById("proposal-content");
    const refreshProposalButton = document.getElementById("refresh-proposal");

    function renderProposal() {
      if (!proposalContent) return;
      const est = loadLastEstimate();

      if (!est) {
        proposalContent.innerHTML =
          '<em>No estimate found yet. Go to the Estimate tab, fill it out, and click "Calculate Estimate" first.</em>';
        return;
      }

      const client = est.client || getCurrentClient();
      const dateStr = est.timestamp
        ? new Date(est.timestamp).toLocaleDateString()
        : "";

      let clientHtml = "";
      if (client) {
        clientHtml = `
          <div class="proposal-header">
            <strong>${client.name || ""}</strong><br />
            ${client.address ? client.address + "<br />" : ""}
            ${client.phone ? "Phone: " + client.phone + "<br />" : ""}
            ${client.email ? "Email: " + client.email + "<br />" : ""}
            ${client.preferred ? "Preferred install: " + client.preferred + "<br />" : ""}
          </div>
        `;
      } else {
        clientHtml = "<p><em>No client selected.</em></p>";
      }

      proposalContent.innerHTML = `
        <div class="proposal-card-inner">
          <p><strong>Proposal date:</strong> ${dateStr}</p>
          ${clientHtml}
          <h3>Christmas Light Installation & Takedown</h3>
          <p><strong>Total feet:</strong> ${est.totalFeet.toFixed(0)} ft (ridge, hip, eaves)</p>
          <ul>
            <li>Install: $${est.installSubtotal.toFixed(2)} (@ $${est.rate.toFixed(2)}/ft)</li>
            <li>Takedown: $${est.takedownSubtotal.toFixed(2)} (@ $${est.takedownRate.toFixed(2)}/ft)</li>
          </ul>
          <div class="proposal-totals">
            <p>Subtotal (install + takedown): $${est.customerSubtotal.toFixed(2)}</p>
            <p>Sales tax (${est.taxRatePercent.toFixed(2)}%): $${est.taxAmount.toFixed(2)}</p>
            <p><strong>Total investment: $${est.customerTotalWithTax.toFixed(2)}</strong></p>
          </div>
          <p style="font-size:0.85rem;margin-top:1rem;">
            This proposal includes professional installation, season-long use, and scheduled takedown of lights.
          </p>
        </div>
      `;
    }

    if (refreshProposalButton) {
      refreshProposalButton.addEventListener("click", renderProposal);
    }

    // Initial proposal render on page load
    renderProposal();
  </script>






  


</body>
</html>
